#!/bin/bash
echo "============================"
echo "ğŸ“¥ å½“å‰æ‹¨å…¥ L2TP å®¢æˆ·ç«¯è¿æ¥"
echo "============================"
last | grep ppp

echo
echo "============================"
echo "ğŸ“¤ å½“å‰æ‹¨å‡º L2TP é€šé“çŠ¶æ€"
echo "============================"
ip -o link show | grep ppp

echo
echo "============================"
echo "ğŸ§­ ç­–ç•¥è·¯ç”±è§„åˆ™ï¼ˆfwmark/IPï¼‰"
echo "============================"
ip rule show | grep -E 'from|fwmark' | sort -n

echo
echo "============================"
echo "ğŸ“Œ è·¯ç”±è¡¨é»˜è®¤ç½‘å…³ç»‘å®š"
echo "============================"
for i in $(seq 101 110); do
  tbl=$(awk -v n="$i" '$1==n {print $2}' /etc/iproute2/rt_tables)
  [[ -z "$tbl" ]] && continue
  route=$(ip route show table "$i" | grep default || echo "æ— é»˜è®¤è·¯ç”±")
  printf "è¡¨ %d (%s): %s\n" "$i" "$tbl" "$route"
done

echo
echo "============================"
echo "ğŸ§© æ‹¨å‡ºé€šé“æœåŠ¡çŠ¶æ€"
echo "============================"
systemctl list-units --type=service | grep l2tpd-vip
